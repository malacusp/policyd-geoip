# ---------------------------------------------------------------------------
# Config file for policyd-geoip2 Postfix policy to filter by country code.
# By Malac inspired by and utilising some code from policyd-spf filter program.
# Version 2.10 August 2025
# This file must be named policyd-geoip.conf and be in /etc/postfix-policyd-geoip/
# All other ".conf" files in the directory can be called anything you want.
# Check you refer to them correctly in this file.  
# This program is free software: you can redistribute it and/or modify it under the terms of the GNU General Public License
# as published by the Free Software Foundation, either version 3 of the License, or (at your option) any later version.
# This program is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;
# without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU General Public License for more details.
# You should have received a copy of the GNU General Public License along with this program. If not, see <https://www.gnu.org/licenses/>.
# ----------------------------------------------------------------------------

[OPTIONS]
# Absolute path to where you have the GeoIP database.
# e.g. path_to_data = /usr/local/share/GeoIP/GeoLite2-Country.mmdb
path_to_data = /usr/share/GeoIP/GeoLite2-Country.mmdb

# Absolute path to directory with other config/list files
# Default Value: /etc/postfix-policyd-geoip
# NO TRAILING SLASH
config_path = /etc/postfix-policyd-geoip

# permit_acceptlist_only
# Only accept country codes on acceptlist regardless of reject list setting.
# If permit_acceptlist_only = true, acceptlist is all that will be allowed through and other country codes will be rejected, e.g. no entries in rejectlist would be required.
# Value: true/false
permit_acceptlist_only = false

# soft_bounce
# Reject with a "Soft Bounce" (450 code) (true) or "Hard Bounce" code (550) (false)
# Value: true/false
soft_bounce = true

# test_mode
# Display check results in mail.log but don't actually reject/bounce emails.
test_mode = false

[LISTS]
# acceptlist
# This can be a string of country codes (e.g. acceptlist=AU,JP,RU,RS,....etc.)
# or a separate file with one code per line, in this case precede the value with "file:"
# e.g. acceptlist=file:accept_list.conf
acceptlist = file:accept_list.conf

# exceptions_to_acceptlist
# This can be a string of server names which you want to reject even if their country code is in acceptlist (e.g. my-country-spam.com,another-spammer.com,botnet.net)
# or a separate file with one server per line, in this case precede the value with "file:"
# e.g. file:accept_list_exceptions.conf
exceptions_to_acceptlist = file:accept_list_exceptions.conf

# rejectlist
# This can be a string of country codes (e.g. rejectlist=AU,JP,RU,RS,....etc.)
# or a separate file with one code per line, in this case precede the value with "file:"
# e.g. rejectlist = file:reject_list.conf
rejectlist = file:reject_list.conf

# exceptions_to_rejectlist
# This can be a string of server names which you want to accept even if their country code is in rejectlist (e.g. example.com,another-server.com,gmail.com)
# or a separate file with one server per line, in this case precede the value with "file:"
# e.g. file:reject_list_exceptions.conf
exceptions_to_rejectlist = file:reject_list_exceptions.conf

# sender_bypasses
# This can be a string of incoming emails or partial email addresses which you want to ignore checks regardless of country code (e.g. okay-to-send-to-us.com,bob@another-good-sender.com,notnet.net)
# or a separate file with one emails or partial per line, in this case precede the value with "file:"
# e.g. file:sender_bypasses.conf
sender_bypasses = file:sender_bypasses.conf

# recipient_bypasses
# This can be a string of receiving emails or partial email addresses for which you want to ignore checks regardless of country code (e.g. accept-anything@my-server.com,bob@dont-care.com,not-bothered-filtering.net)
# or a separate file with one email or partial per line, in this case precede the value with "file:"
# e.g. file:recipient_bypasses.conf
# This is handy for a catchall/forwarding/transport acount if you wish to manually check emails for valid senders, servers, etc.
recipient_bypasses = file:recipient_bypasses.conf

[EXTERNAL LOGGING]
# log_reject_to_file
# Store rejected server details to a text file.
# Value: true/false 
log_reject_to_file = false

# external_reject_file
# This is NOT the syslog file e.g. /var/log/mail.log this is a separate file for audit purposes.
# Using this will not change mail.log messages other than add a notification that a line was written to the text file on rejection.
# Full path to text file for storing rejected information.
# Value : /var/log/policyd-geoip2.log
# N.B. THIS FILE WILL NOT GET CLEARED AUTOMATICALLY SO YOU MUST MANUALLY CLEAR IT OR ADD A LOG ROTATE JOB TO STOP IT GROWING TOO BIG.
external_reject_file = /var/log/policyd-geoip2.log

[DATABASE]
# EXPERIMENTAL MYSQL DATABASE LOGGING FEATURES. USE AT OWN RISK AND IF YOU UNDERSTAND MYSQL.
# dbname, dbuser, dbhost, dbpassword
# MySQL database connection details
# The file policyd-geoip2.sql contains structure data which can be imported using phpmyadmin or directly with mysql.
# This file will need editing to suit your setup but should give you the idea of creating the database and table structure
dbname = policyd-geoip
dbuser = policyd-geoip
dbhost = localhost
dbpassword = [enter your password]

# log_reject_to_db
# Store rejected servers to a mysql database.
# Value: true/false 
log_reject_to_db = false

# auto_clear_db
# Automatically clear the database logs periodically.
# Interval is set in auto_clear_time
# Value true/false
auto_clear_db = true

# auto_clear_time
# Period after which auto_clear_db is executed.
# Value: {number} followed by either s, m, h, d for seconds, minutes, hours, days (e.g. 30m or 12h or 7d).
auto_clear_time = 7d
